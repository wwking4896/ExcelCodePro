# ExcelCode Pro

ExcelCode Pro 是一款強大的工具，用於將 Excel 表格資料轉換為 C/C++ 程式碼。透過自訂範本和靈活的範圍選擇，使得從資料到程式碼的轉換過程變得簡單且高效。

## 目錄

1. [功能概述](#功能概述)
2. [程式架構](#程式架構)
3. [安裝與執行](#安裝與執行)
4. [基本使用流程](#基本使用流程)
5. [範本系統](#範本系統)
   - [範本基礎](#範本基礎)
   - [範本標記語法](#範本標記語法)
   - [橫向和直向讀取模式](#橫向和直向讀取模式)
   - [命名範圍](#命名範圍)
   - [參數區塊功能](#參數區塊功能)
   - [多維陣列處理](#多維陣列處理)
6. [範本範例](#範本範例)
7. [命令行模式](#命令行模式)
8. [進階功能](#進階功能)
9. [疑難排解](#疑難排解)
10. [技術支援](#技術支援)

## 功能概述

ExcelCode Pro 提供以下核心功能：

- **多檔案處理**：可同時處理多個 Excel 檔案
- **工作表選擇**：靈活選擇要處理的工作表
- **範圍管理**：支援多種範圍選擇方式，包括命名範圍
- **整合式範圍管理器**：結合範圍選擇和命名功能
- **靈活的範本系統**：提供多種預設範本及強大的自訂範本功能
- **參數區塊功能**：支援模板中的可重用參數區塊
- **資料預覽**：即時預覽選定範圍的資料
- **程式碼生成**：自動生成結構化的 C/C++ 程式碼
- **命令行模式**：支援批處理和自動化操作
- **設定檔儲存/載入**：保存和復原完整的工作設定
- **多語言支援**：界面和操作完全支援繁體中文
- **收納式側邊欄**：可收納的控制面板，提供更大的程式碼顯示區域

## 程式架構

ExcelCode Pro 採用模組化設計，主要由以下幾個部分組成：

1. **主程式 (main.py)**：程式入口點，設定基本環境並啟動應用程式
2. **圖形介面 (gui.py)**：處理使用者界面互動和視覺元素展示
3. **Excel 處理器 (excel_handler.py)**：負責 Excel 檔案的載入和資料處理
4. **程式碼生成器 (code_generator.py)**：根據範本和資料生成最終程式碼
5. **公用工具 (utils.py)**：提供各種輔助功能
6. **版本控制 (version.py)**：管理版本和更新檢查
7. **命令行介面 (console.py)**：提供無介面操作模式

## 安裝與執行

### 系統需求

- Python 3.x (建議 3.13 或更高版本)
- pandas, numpy 等相依套件

### 安裝步驟

1. 下載完整程式碼或執行檔
2. 如果使用原始碼，安裝必要相依套件：
   ```
   pip install -r requirements.txt
   ```

### 執行方式

#### 圖形介面模式
- 使用執行檔：直接點擊 `ExcelCode Pro.exe`
- 使用原始碼：
  ```
  python main.py
  ```
  或執行 `run.bat`

#### 命令行模式
- 使用執行檔：
  ```
  ExcelCode-Console.exe --config config.json --output output.c
  ```
- 使用批次檔：編輯並執行 `console.bat`

## 基本使用流程

### 1. 選擇 Excel 檔案

- 點擊「瀏覽...」按鈕選擇單一 Excel 檔案
- 點擊「多選...」按鈕選擇多個 Excel 檔案
- 或從「最近使用的檔案」選單中選取最近使用的檔案

### 2. 選擇工作表

從下拉選單中選擇要處理的工作表。

### 3. 設定範圍

點擊「範圍管理」按鈕，在彈出的整合式範圍管理器中可以：
- 輸入 Excel 範圍格式（如 A1:G10）添加新範圍
- 為範圍設定名稱（方便在範本中引用）
- 預覽所選範圍的實際資料
- 管理多個範圍（添加/刪除/重命名）

### 4. 設定程式碼範本

選擇一種範本方式：
- 從下拉選單中選擇預設範本
- 點擊「設定自訂範本」創建自己的範本
- 點擊「匯入範本」從外部檔案載入範本
- 使用「管理範本」功能管理已儲存的範本

### 5. 生成程式碼

點擊「生成程式碼」按鈕，程式將根據選定的範圍和範本生成 C/C++ 程式碼。

### 6. 儲存結果

- 點擊「儲存程式碼」將生成的程式碼儲存為檔案
- 點擊「複製到剪貼簿」將程式碼複製到剪貼簿

## 範本系統

ExcelCode Pro 的範本系統是其最強大的特性之一，使用者可以通過範本完全控制生成程式碼的結構和格式。

### 範本基礎

範本本質上是一段包含特殊標記（佔位符）的文字，這些標記會在生成程式碼時被實際資料取代。範本可以是任何文字，但通常會是 C/C++ 程式碼架構。

### 範本標記語法

#### 基本標記

| 標記 | 說明 | 示例結果 |
|------|------|----------|
| `{{LOOP_START}}` | 開始資料循環 | - |
| `{{LOOP_END}}` | 結束資料循環 | - |
| `{{VALUE}}` | 當前儲存格值 | `5` |
| `{{ROW_INDEX}}` | 當前行索引 | `0`, `1`, `2` |
| `{{COL_INDEX}}` | 當前列索引 | `0`, `1`, `2` |
| `{{ALL_COLUMNS}}` | 當前行的所有列值 | `1, 2, 3, 4` |
| `{{ALL_ROWS}}` | 當前列的所有行值 | `1, 5, 9, 13` |
| `{{COL:n}}` | 當前行的第 n 列值 | `{{COL:0}}` → `1` |
| `{{ROW:n}}` | 當前列的第 n 行值 | `{{ROW:0}}` → `1` |

#### 方向控制標記

| 標記 | 說明 |
|------|------|
| `{{DIRECTION:ROW}}` | 設定為橫向讀取模式（預設） |
| `{{DIRECTION:COLUMN}}` | 設定為直向讀取模式 |

#### 多範圍標記

| 標記 | 說明 |
|------|------|
| `{{RANGE[範圍名稱]_LOOP_START}}` | 特定命名範圍的循環開始 |
| `{{RANGE[範圍名稱]_LOOP_END}}` | 特定命名範圍的循環結束 |
| `{{RANGE[範圍名稱]_ROW_COUNT}}` | 命名範圍的行數 |
| `{{RANGE[範圍名稱]_COL_COUNT}}` | 命名範圍的列數 |
| `{{RANGE[範圍名稱]_VALUE[行,列]}}` | 命名範圍中特定位置的值 |

#### 檔案相關標記

| 標記 | 說明 |
|------|------|
| `{{FILE_NAME}}` | 當前處理的檔案名稱 |
| `{{FILE_INDEX}}` | 當前檔案索引 |
| `{{FILE_COUNT}}` | 總檔案數量 |

#### 多維陣列特殊標記

| 標記 | 說明 |
|------|------|
| `{{FILES_LOOP_START}}` | 檔案循環開始 |
| `{{FILES_LOOP_END}}` | 檔案循環結束 |
| `{{RANGES_LOOP_START}}` | 範圍循環開始 |
| `{{RANGES_LOOP_END}}` | 範圍循環結束 |
| `{{RANGE_LOOP_START}}` | 範圍內資料循環開始 |
| `{{RANGE_LOOP_END}}` | 範圍內資料循環結束 |

### 參數區塊功能

參數區塊允許在模板中定義可重用的程式碼區塊，特別適合處理多個相似結構但使用不同範圍的程式碼。

#### 參數區塊語法

```
{{ARGUMENT_START:引數名稱}}
// 範圍名稱=範圍1,範圍2
// 程式碼區塊，可使用範圍標記
{{ARGUMENT_END:引數名稱}}
```

#### 範例：使用參數區塊

```c
// 定義多個陣列的通用結構
{{ARGUMENT_START:TABLES}}
// 範圍名稱=左上,右上,左下,右下
unsigned int {{RANGE[name]_NAME}}_TABLE[{{RANGE[name]_ROW_COUNT}}][{{RANGE[name]_COL_COUNT}}] = {
{{RANGE[name]_LOOP_START}}
    { {{ALL_COLUMNS}} },
{{RANGE[name]_LOOP_END}}
};
{{ARGUMENT_END:TABLES}}
```

## 範本範例

### 使用參數區塊的範例

```c
// 使用參數區塊定義多個表格
{{ARGUMENT_START:WEIGHT_TABLES}}
// 範圍名稱=Normal,Free,Skill
static unsigned int {{RANGE[name]_NAME}}_table[{{RANGE[name]_ROW_COUNT}}][{{RANGE[name]_COL_COUNT}}] = {
{{RANGE[name]_LOOP_START}}
    { {{ALL_COLUMNS}} },
{{RANGE[name]_LOOP_END}}
};
{{ARGUMENT_END:WEIGHT_TABLES}}
```

### 整合式權重表設定

```c
// 遊戲權重表初始化
void initVariableWeights() {
{{ARGUMENT_START:WEIGHT_INIT}}
// 範圍名稱=Normal,Free,Skill
{{RANGE[name]_LOOP_START}}
    {{RANGE[name]_NAME}}_table_weight[{{COL:0}}][{{COL:1}}][{{COL:2}}][{{COL:3}}] = {{VALUE}};
{{RANGE[name]_LOOP_END}}
{{ARGUMENT_END:WEIGHT_INIT}}
}
```

## 命令行模式

ExcelCode Pro 提供完整的命令行介面，適合批處理和自動化操作。

### 使用方法

```
ExcelCode-Console.exe --config config.json --output output.c [--verbose]
```

### 配置文件格式

```json
{
  "excel_files": ["path/to/file1.xlsx", "path/to/file2.xlsx"],
  "selected_sheet": "Sheet1",
  "selected_ranges": [
    {
      "start_row": 0,
      "start_col": 0,
      "end_row": 10,
      "end_col": 3,
      "range_str": "A1:D11"
    }
  ],
  "named_ranges": {
    "左上": "A1:C5",
    "右上": "D1:F5"
  },
  "template_type": "preset",
  "preset_template": "二維陣列",
  "template_direction": "row"
}
```

### 參數說明

- `--config` 或 `-c`：指定配置文件路徑
- `--output` 或 `-o`：指定輸出文件路徑
- `--verbose` 或 `-v`：啟用詳細日誌輸出

## 進階功能

### 整合式範圍管理器

新版本提供整合式範圍管理器，在同一界面中完成：
- 範圍選擇和新增
- 範圍命名和管理
- 實時數據預覽
- 命名範圍操作（重命名、刪除）

### 收納式控制面板

左側控制面板可以收納，提供更大的程式碼顯示區域：
- 點擊 "<<" 按鈕可收起控制面板
- 點擊 ">>" 按鈕可展開控制面板

### 設定檔儲存與載入

您可以儲存當前的工作設定，包括：
- 已選擇的 Excel 檔案
- 工作表選擇
- 範圍設定（包括命名範圍）
- 範本選擇和內容

使用「儲存設定」和「載入設定」按鈕來管理設定檔。

### 匯入/匯出範本

您可以：
- 將自訂範本儲存為外部檔案
- 從外部檔案載入範本
- 管理多個範本
- 儲存範本到指定目錄供後續使用

## 疑難排解

### 常見問題

1. **範本中的標記沒有被正確替換**
   - 檢查標記語法是否正確
   - 確認範圍是否有效且包含資料
   - 檢查參數區塊的配對是否正確

2. **生成的程式碼中有逗號問題**
   - 範本中的陣列初始化語法可能需要調整
   - 檢查循環結束位置是否正確處理最後一項

3. **資料類型處理不正確**
   - 預設情況下，程式會嘗試識別數值類型
   - 文字值將被包裹在引號中
   - 可以透過範本自訂數據格式

4. **參數區塊處理問題**
   - 確保 ARGUMENT_START 和 ARGUMENT_END 標籤配對
   - 檢查範圍名稱是否正確指定
   - 留意參數區塊中的範圍引用格式

### 日誌檢視

程式底部的「執行日誌」區域會顯示重要的操作和錯誤信息，可用於診斷問題。命令行模式下，日誌會儲存在 `app.log` 文件中。

## 技術支援

如有問題或建議，請聯繫開發者：
- 透過 GitHub 提交 Issue
- 發送電子郵件至 [wu0851202@gmail.com]

---

ExcelCode Pro v1.0.0
© 2025 WWKing - Alphabet Studio 版權所有